# Trading pairs to monitor - Top 10 volume pairs on Binance
symbols = [
    "BTCUSDT",   # Bitcoin - #1 volume ($871M/day, 19% dominance)
    "ETHUSDT",   # Ethereum - #2 volume
    "SOLUSDT",   # Solana - #3 volume
    "BNBUSDT",   # Binance Coin - #4 volume
    "XRPUSDT",   # Ripple - #5 volume
    "TRXUSDT",   # Tron - #6 volume
    "ADAUSDT",   # Cardano - #7 volume
    "DOGEUSDT",  # Dogecoin - #8 volume
    "AVAXUSDT",  # Avalanche - #9 volume
    "DOTUSDT"    # Polkadot - #10 volume
]

[server]
host = "0.0.0.0"
port = 8080

[database]
max_connections = 8  # Increased from 5 for 10 trading pairs
min_connections = 2  # Keep warm connections ready
max_lifetime = 1800  # 30 minutes

[cache]
[cache.memory]
max_ticks_per_symbol = 1000
ttl_seconds = 300

[cache.redis]
pool_size = 10
ttl_seconds = 3600
max_ticks_per_symbol = 10000

[paper_trading]
enabled = true
strategy = "rsi_python"
initial_capital = 10000.0

[strategies]
# Directory containing Python strategy files
python_dir = "strategies"

# Enable hot-reload (development only - reloads Python files without restart)
hot_reload = true

# Hot-reload configuration
[strategies.hot_reload_config]
# Debounce time in milliseconds (wait before reloading after file change)
# This prevents multiple rapid reloads from successive file save events
debounce_ms = 300

# Skip SHA256 hash verification on hot-reload (development mode only)
# WARNING: Only enable in trusted development environments
# Production should always keep this false for security
skip_hash_verification = true

# Registered Python strategies
[[strategies.python]]
id = "sma_python"
file = "examples/example_sma.py"
class_name = "ExampleSmaStrategy"
description = "Example Python SMA implementation"
enabled = true
sha256 = "228f8afcc69bfe6d4cdb26557932400e74e23ac1cfe5671847237786da9bda02"

[strategies.python.limits]
max_execution_time_ms = 10  # 10ms timeout per tick

[[strategies.python]]
id = "rsi_python"
file = "examples/example_rsi.py"
class_name = "ExampleRsiStrategy"
description = "Example Python RSI implementation"
enabled = true
sha256 = "77803d3f6ea63780f25e95eed0a0ae1415e313c9c4ed6d939cc7dc61459122b3"

[strategies.python.limits]
max_execution_time_ms = 10  # 10ms timeout per tick

[validation]
# Enable tick data validation (default: true)
enabled = true

# Maximum price change per tick (percentage)
# 10.0 = allow up to 10% price movement between consecutive ticks
max_price_change_pct = 10.0

# Timestamp tolerance (minutes)
# Allow up to 5 minutes clock skew
timestamp_tolerance_minutes = 5

# Maximum past timestamp (days)
# Allow historical data up to 10 years old
max_past_days = 3650

[reconnection_rate_limit]
# Maximum number of WebSocket reconnection attempts allowed in the time window
# Prevents getting banned from exchanges due to excessive reconnection attempts
max_attempts = 5

# Time window in seconds (60 = per minute, 3600 = per hour)
# Exchange APIs typically have rate limits on connections
window_secs = 60

# Optional: Custom wait duration in seconds when rate limit is exceeded
# If not set, defaults to window_secs
# wait_on_limit_secs = 60

# =================================================================
# Data Source Configuration
# =================================================================
# Controls where trading-core receives market data from:
# - "binance": Direct WebSocket connection to Binance (default)
# - "ipc": Receive data from data-manager via shared memory IPC

[data_source]
# Data source type: "binance" or "ipc"
# Use --data-source flag to override at runtime
type = "binance"

# IPC configuration (used when type = "ipc")
[data_source.ipc]
# Shared memory path prefix (must match data-manager)
shm_path_prefix = "/data_manager_"
# Poll interval in microseconds when no data available
poll_interval_us = 100
# Channel buffer size for tick forwarding
channel_buffer_size = 10000

[alerting]
# Enable the alerting system for monitoring critical metrics
enabled = true

# How often to evaluate alert rules (in seconds)
interval_secs = 30

# Cooldown period between repeated alerts for the same condition (in seconds)
# This prevents alert spam when a condition persists
cooldown_secs = 300  # 5 minutes

# Connection pool saturation threshold (0.0-1.0)
# WARNING alert when pool utilization exceeds this percentage
pool_saturation_threshold = 0.8  # 80%

# Connection pool critical threshold (0.0-1.0)
# CRITICAL alert when pool utilization exceeds this percentage
pool_critical_threshold = 0.95  # 95%

# Batch failure rate threshold (0.0-1.0)
# WARNING alert when batch failure rate exceeds this percentage
batch_failure_threshold = 0.2  # 20%

# Channel backpressure threshold (0.0-100.0)
# WARNING alert when channel utilization exceeds this percentage
channel_backpressure_threshold = 80.0  # 80%

# WebSocket reconnection storm threshold (number of reconnects)
# WARNING alert when reconnection count exceeds this value
reconnection_storm_threshold = 10

# =================================================================
# Symbol Registry Configuration
# =================================================================
# Central registry for symbol metadata, trading specifications, and session schedules

[symbol_registry]
# Enable the symbol registry service
enabled = true

# Cache configuration
cache_capacity = 10000       # Maximum number of symbols to cache
cache_ttl_secs = 3600        # Cache TTL in seconds (1 hour)

# Default behaviors
preload_symbols = true       # Preload configured symbols on startup
lazy_load = true             # Enable lazy loading for uncached symbols

# Default venue configurations
[symbol_registry.venue_defaults]
# Default settings applied when venue-specific config is missing
default_tick_size = "0.01"
default_lot_size = "0.001"
default_min_notional = "10.0"

# Binance-specific defaults
[symbol_registry.venue_defaults.BINANCE]
maker_fee = "0.001"          # 0.1% maker fee
taker_fee = "0.001"          # 0.1% taker fee
min_notional = "10.0"        # Minimum order value in quote currency

# CME Globex defaults (for futures)
[symbol_registry.venue_defaults.GLBX]
maker_fee = "0.0"            # Varies by membership/contract
taker_fee = "0.0"
session_schedule = "cme_globex"

# =================================================================
# Session Manager Configuration
# =================================================================
# Real-time market session state tracking

[session_manager]
# Enable the session manager service
enabled = true

# How often to check session states (in seconds)
check_interval_secs = 60

# Event broadcast channel capacity
event_channel_capacity = 256

# Session enforcement for order validation
# Options: "disabled", "warn", "strict"
order_session_enforcement = "warn"

# Predefined session schedules
[session_manager.schedules]

# CME Globex electronic trading hours (Sunday-Friday)
[session_manager.schedules.cme_globex]
timezone = "America/Chicago"
sessions = [
    { start = "17:00", end = "16:00", next_day = true, session_type = "regular" }
]
# Maintenance window
maintenance_start = "16:00"
maintenance_end = "17:00"

# NYSE/NASDAQ regular trading hours
[session_manager.schedules.us_equity]
timezone = "America/New_York"
sessions = [
    { start = "04:00", end = "09:30", session_type = "pre_market" },
    { start = "09:30", end = "16:00", session_type = "regular" },
    { start = "16:00", end = "20:00", session_type = "after_hours" }
]

# Crypto 24/7 trading
[session_manager.schedules.crypto_24_7]
timezone = "UTC"
sessions = [
    { start = "00:00", end = "23:59:59", session_type = "regular" }
]

# =================================================================
# Roll Manager Configuration (Continuous Contracts)
# =================================================================
# Configuration for managing continuous futures contracts

[roll_manager]
# Enable the roll manager service
enabled = false              # Disabled by default (crypto doesn't need it)

# Calendar-based roll: days before expiration to trigger roll
calendar_roll_days = 5

# Volume-based roll: ratio threshold (1.5 = next contract has 50% more volume)
volume_roll_threshold = "1.5"

# Open interest-based roll: ratio threshold
oi_roll_threshold = "1.5"

# Event broadcast channel capacity
event_channel_capacity = 256

# Continuous contracts to track (example for futures trading)
# [[roll_manager.continuous_contracts]]
# symbol = "ES.c.0.GLBX"      # E-mini S&P 500 front month (calendar roll)
# roll_method = "calendar"

# [[roll_manager.continuous_contracts]]
# symbol = "CL.v.0.NYMX"      # Crude Oil front month (volume roll)
# roll_method = "volume"

# =================================================================
# Symbol Definitions (Override database definitions)
# =================================================================
# Define symbols directly in config (useful for development/testing)
# These will be merged with database definitions

# Example crypto spot symbol definition
# [[symbol_definitions]]
# symbol = "BTCUSDT"
# venue = "BINANCE"
# asset_class = "CRYPTO"
# instrument_class = "SPOT"
# base_currency = "BTC"
# quote_currency = "USDT"
# tick_size = "0.01"
# lot_size = "0.00001"
# min_notional = "10.0"
# maker_fee = "0.001"
# taker_fee = "0.001"
# session_schedule = "crypto_24_7"

# Example futures symbol definition
# [[symbol_definitions]]
# symbol = "ESH6"
# venue = "GLBX"
# asset_class = "EQUITY"
# instrument_class = "FUTURE"
# underlying = "SPX"
# tick_size = "0.25"
# tick_value = "12.50"
# contract_size = "50"
# expiration = "2026-03-21"
# session_schedule = "cme_globex"