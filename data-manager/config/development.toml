# Development environment overrides

[database]
max_connections = 5
min_connections = 1

[symbols]
# Smaller symbol set for development/testing
default_symbols = [
    "ES.FUT@GLBX",    # E-mini S&P 500
    "NQ.FUT@GLBX",    # E-mini Nasdaq-100
]

# =================================================================
# Binance Provider Configuration
# =================================================================

[provider.binance]
# Enable Binance provider for crypto data
enabled = true
# WebSocket URL (US version)
ws_url = "wss://stream.binance.us:9443/stream"
# Reconnection rate limiting
rate_limit_attempts = 5
rate_limit_window_secs = 60
# Default crypto symbols
default_symbols = [
    "BTCUSDT",
    "ETHUSDT",
]

# Binance reconnection settings
[provider.binance.reconnection]
initial_delay_secs = 1           # Initial reconnection delay
max_delay_secs = 60              # Maximum reconnection delay (exponential backoff cap)
max_attempts = 10                # Maximum reconnection attempts before giving up

# =================================================================
# IPC Transport Configuration
# =================================================================

[transport.ipc]
enabled = true
# Shared memory path prefix (must match trading-core)
shm_path_prefix = "/data_manager_"
# Ring buffer entries per symbol
ring_buffer_entries = 65536
# Entry size in bytes
entry_size = 256

# =================================================================
# Backfill Configuration
# =================================================================
# IMPORTANT: Backfill is DISABLED by default to prevent accidental
# costs from Databento API calls. Enable carefully and set appropriate limits.

[backfill]
# Master switch - MUST be explicitly enabled
enabled = false
# Operational mode: "disabled" | "on_demand" | "scheduled" | "manual_only"
mode = "disabled"

[backfill.cost_limits]
# Maximum cost per single request (USD)
max_cost_per_request = 10.0
# Maximum daily spend (USD)
max_daily_spend = 50.0
# Maximum monthly spend (USD)
max_monthly_spend = 500.0
# Require confirmation above this threshold (USD)
confirmation_threshold = 5.0
# Auto-approve requests below this threshold (USD)
auto_approve_threshold = 1.0
# Enable auto-approval (disabled by default for safety)
auto_approve_enabled = false

[backfill.on_demand]
# Enable on-demand backfill (triggers when data is missing)
enabled = false
# Maximum lookback period (days)
max_lookback_days = 30
# Minimum gap size to trigger backfill (minutes)
min_gap_minutes = 5
# Priority for on-demand jobs (higher = more urgent)
priority = 10
# Cooldown between auto-triggered requests for same symbol (seconds)
cooldown_secs = 300

[backfill.scheduled]
# Enable scheduled backfill (fills gaps via scheduled jobs)
enabled = false
# Cron expression for gap-filling schedule
schedule = "0 0 * * *"
# Maximum gaps to fill per scheduled run
max_gaps_per_run = 10
# Priority for scheduled jobs
priority = 0

[backfill.provider]
# Provider name
name = "databento"
# Default dataset (CME Globex)
dataset = "GLBX.MDP3"
# Maximum concurrent backfill jobs
max_concurrent_jobs = 2
# Request timeout in seconds
timeout_secs = 300
# Retry attempts for failed requests
retry_attempts = 3

# =================================================================
# Provider Routing Configuration
# =================================================================
# Maps symbols to data providers for both realtime and historical data.
# Uses three-tier resolution: Symbol-specific → Asset type → Global default

[routing]
# Default provider when no routing rules match
default_provider = "databento"

# Databento-specific dataset mappings
[routing.databento]
default_dataset = "GLBX.MDP3"

# Dataset mappings: "asset_type@exchange" -> dataset
[routing.databento.datasets]
"futures@CME" = "GLBX.MDP3"
"futures@CBOT" = "GLBX.MDP3"
"futures@NYMEX" = "GLBX.MDP3"
"futures@COMEX" = "GLBX.MDP3"
"futures@GLBX" = "GLBX.MDP3"
"equity@NASDAQ" = "XNAS.ITCH"
"equity@NYSE" = "XNYS.TRADES"

# Asset type routing rules (fallback tier)
[routing.asset_types.futures]
historical = "databento"
realtime = "databento"
default_exchange = "CME"

[routing.asset_types.equity]
historical = "databento"
realtime = "databento"
default_exchange = "NASDAQ"

[routing.asset_types.crypto]
historical = "databento"
realtime = "binance"
default_exchange = "BINANCE"

[routing.asset_types.fx]
historical = "databento"
realtime = "databento"

# Symbol-specific routing rules (highest priority)
# Uncomment and customize as needed:
#
# [[routing.symbols]]
# symbol = "ES"
# exchange = "CME"
# asset_type = "futures"
# [routing.symbols.historical]
# provider = "databento"
# dataset = "GLBX.MDP3"
# [routing.symbols.realtime]
# provider = "databento"
# dataset = "GLBX.MDP3"
# [routing.symbols.provider_symbols]
# databento = "ES.FUT"

# =================================================================
# DATA VALIDATION CONFIGURATION
# =================================================================
# Validation rules for incoming tick data to ensure data quality

[validation]
# Enable tick data validation
enabled = true
# Maximum price (reject ticks above this value) - $10M default
max_price = "10000000"
# Maximum price change per tick (percentage) - reject >50% changes
max_price_change_percent = "50"
# Maximum symbol length
max_symbol_length = 20
# Maximum exchange name length
max_exchange_length = 20
# Maximum trade ID length
max_trade_id_length = 100
# Maximum timestamp age in hours (reject ticks older than this)
max_timestamp_age_hours = 24
# Maximum timestamp future tolerance in seconds
max_timestamp_future_secs = 60
# Require trade ID on all ticks
require_trade_id = false

# Symbol-specific price change thresholds (overrides default)
# Use lower thresholds for stablecoins, higher for volatile assets
[validation.symbol_overrides]
BTCUSDT = "10"    # 10% max change for Bitcoin
ETHUSDT = "15"    # 15% max change for Ethereum
USDTUSDC = "1"    # 1% max for stablecoin pairs
BUSDUSDT = "1"    # 1% max for stablecoin pairs

# =================================================================
# SCHEDULER CONFIGURATION
# =================================================================
# Job scheduling and management settings

[scheduler]
# Maximum job history entries to retain
max_job_history = 100
# Job cleanup interval in seconds
cleanup_interval_secs = 3600     # 1 hour

# =================================================================
# SUBSCRIPTION CONFIGURATION
# =================================================================
# Market data subscription settings

[subscription]
# Default snapshot depth for order book
snapshot_depth = 100
# Default backfill duration in minutes (when data is missing)
default_backfill_duration_minutes = 5
# Default backfill max records
default_backfill_max_records = 10000
